<Html>
<Head>
  <Style>
    table { border: 1px solid red; width: 80%; align: center; }
    tr { border: 1px solid green; }
    th { border: 1px solid blue; }
    td { border: 1px solid green; text-align: center; }
  </Style>
</Head>
<Body BGColor="White">


<P>
An average home in Montclair assessed at <span id="avgHomeValue"></span>
will see a tax increase of 
$258
in 
2023 
and an average tax increase of
$732 by
2027
</P>

<P>
My home is assessed at 
<Input Type="number" id="myHomeValue" value="0">
<button id="dowork">Compute</button>
</P>
<P>
I will see addition tax for each year of:
<Table id="annualCosts">
</Table>
</P>

<script>
  document.addEventListener("DOMContentLoaded", () => populateInitialValues("avgHomeValue", "myHomeValue", "annualCosts"));

  let dowork = document.getElementById("dowork");
  dowork.onclick = function() 
  {
    displayAnnualCosts("myHomeValue", "annualCosts");
  }
</script>

<script>
  
  const avgHomeValue = 628952; // Average house value
  const coffeeCost = 1.50; // Cost of a cup of coffee

  // Table of payments based upon expected bond sales
  let tranches = [ 
	{firstYear: 2022, years: 20, amount: 100}, 
	{firstYear: 2024, years: 20, amount: 300}, 
	{firstYear: 2026, years: 20, amount: 500}, 
	];


  const moneyFormat = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
  const coffeeFormat = new Intl.NumberFormat('en-US', { maximumSignificantDigits: 3 });
  let annualCost = new Map();

  // From the tranches, determine each year's costs
  function buildCostTable()
  {

    // Add a given amount to what is to be paid each year.
    function addToCost(year, amount)
    {
      if (annualCost.has(year))
      {
        annualCost.set(year, annualCost.get(year) + amount)
      }
      else
      {
        annualCost.set(year, amount)
      }
    }

    // Look over each tranche, adding the amount owed for a given year to 
    // that year's total.
    for (const tranch of tranches)
    {
      for (let year = tranch.firstYear; year < (tranch.firstYear + tranch.years); year++)
      {
        addToCost(year, tranch.amount);
      }
    }
  }

  // Display a table of bond repayments
  function displayAnnualCosts(homeValueElementName, targetElementName)
  {
    let table = document.getElementById(targetElementName);
    const myHomeValue = document.getElementById(homeValueElementName).value; // Is this a number?
    const ratio = myHomeValue / avgHomeValue; // Is this a number?

    table.innerHTML = "<TR><TH>Year<TH>Amount<TH>Daily Amount<TH>Cups of Coffee</TR>"; // Header for table

    for (const [year, amount] of annualCost)
    {
        // Should test the product of amount and ratio for isNaN()
	annualAmount = amount * ratio;
	dailyAmount = annualAmount / 365;
	coffeeAmount = dailyAmount / coffeeCost;
	table.innerHTML += "<TR><TD>" + year.toString() + 
		"<TD>" + moneyFormat.format(annualAmount) + 
		"<TD>" + moneyFormat.format(dailyAmount) + 
		"<TD>" + coffeeFormat.format(coffeeAmount) + 
		"<\TR>";
    }
  }

  // Set up initial values: Average home value, payment tables, etc.
  function populateInitialValues(avgHomeValueElementName, homeValueElementName, targetElementName)
  {
    buildCostTable(); // From the tranche sales, determine annual payments for average home


    // Put average home price on the page
    let avgHomeValueElement = document.getElementById(avgHomeValueElementName);
    avgHomeValueElement.innerHTML = moneyFormat.format(avgHomeValue);

    // Set the initial value of "my home value" to the average home price
    let myHomeValueElement = document.getElementById(homeValueElementName);
    myHomeValueElement.value = avgHomeValue;

    // Display initial payment table
    displayAnnualCosts(homeValueElementName, targetElementName);
  }

</script>


</Body>
</Html>
